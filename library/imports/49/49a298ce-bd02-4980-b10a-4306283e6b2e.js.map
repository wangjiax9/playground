{"version":3,"sources":["../../../../../assets/script/cc/assets/script/cc/DialogSource.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"../../../../../assets/script/cc","sourcesContent":["import GM from '../global/GM'\nimport { fetchGainList, gainPower } from '../api/Index'\nimport { powerTypeEx, powerCn } from '../utils/Const'\nimport { isValid } from '../../../creator';\n\nconst { ccclass, property } = cc._decorator\n\n@ccclass\nexport default class DialogSource extends cc.Component {\n\n  protected onLoad () {\n    const params = {\n      accountId: GM.user.accountId\n    }\n    fetchGainList(params).then(res => {\n      this.loadPrefab(res)\n    }).catch(err => {\n      cc.log(err)\n    })\n  }\n\n  private loadPrefab(res: any) {\n    cc.loader.loadRes('prefab/source-item', cc.Prefab, (err, prefab) => {\n      if (err) {\n          cc.error(err.message || err);\n          return;\n      }\n      if (prefab instanceof cc.Prefab) {\n        this.buildResouce(res, prefab)\n      }\n    })\n    \n  }\n  private buildResouce(res: any, prefab: cc.Prefab) {\n    res.data.forEach(item => {\n      const itemNode = cc.instantiate(prefab)\n      const contentNode = cc.find('view/content', GM.dialog.dialogSource)\n      contentNode.addChild(itemNode)\n      itemNode.setPosition(74, -100)\n      const gameBg = cc.find('game-bg', itemNode)\n      const borderBg = cc.find('border-bg', itemNode)\n      const content = cc.find('content', itemNode)\n      const contentLabel = cc.find('content/label', itemNode)\n      const btn = cc.find('btn', itemNode)\n      const btnLabel = cc.find('btn/label', itemNode)\n\n      let sf: cc.SpriteFrame = null\n      if (item.gameId === 'h48') {\n        sf = GM.resManager.texture['item-sdyxl-bg']\n      } else if (item.gameId === 'g37') {\n        sf = GM.resManager.texture['item-yys-bg']\n      } else {\n        sf = GM.resManager.texture['item-zszz-bg']\n      }\n      // 设置游戏背景\n      gameBg.getComponent(cc.Sprite).spriteFrame = sf\n      // 设置内容\n      contentLabel.getComponent(cc.Label).string = item.content\n      // 设置按钮值\n      btnLabel.getComponent(cc.Label).string = item.powerGain\n      if (item.status === 1) {\n        btn.getComponent(cc.Sprite).spriteFrame = GM.resManager.texture['got-btn']\n        btnLabel.getComponent(cc.Label).string = ''\n      } else {\n        item.isGain = false\n        // 获取按钮事件\n        btn.on(cc.Node.EventType.TOUCH_START, () => {\n          if (item.isGain) return\n          btn.runAction(cc.scaleTo(0.2, 0.9, 0.9))\n        }, this)\n        btn.on(cc.Node.EventType.TOUCH_END, () => {\n          if (item.isGain) return\n          item.isGain = true\n          btn.runAction(cc.scaleTo(0.2, 1, 1))\n          btn.getComponent(cc.Sprite).spriteFrame = GM.resManager.texture['got-btn']\n          btnLabel.getComponent(cc.Label).string = ''\n          btn.off(cc.Node.EventType.TOUCH_START, () => {}, this)\n          btn.off(cc.Node.EventType.TOUCH_END, () => {}, this)\n          borderBg.getComponent(cc.Sprite).spriteFrame = GM.resManager.texture['source-border-disabled']\n  \n          let power = GM.user[powerTypeEx(item.powerType)]\n          power += item.powerGain\n          GM.user[powerTypeEx(item.powerType)] = power\n          GM.toast(`${powerCn(item.powerType)} +${item.powerGain}`)\n          GM.updateUserPower()\n          this.getPower(item)\n        }, this)\n      }\n    })\n  }\n  /**\n   * 获取神力\n   */\n  private getPower(item: any) {\n    const params = {\n      accountId: GM.user.accountId,\n      gainId: item.gainId,\n      gameId: item.gameId,\n      powerGain: item.powerGain,\n      powerType: item.powerType\n    }\n    gainPower(params).then(res => {\n      cc.log(`获取神力成功！`)\n    })\n  }\n}"]}