{"version":3,"sources":["../../../../../assets/script/cc/assets/script/cc/DialogJoinPray.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"../../../../../assets/script/cc","sourcesContent":["import GM from '../global/GM'\nimport { prayPower } from '../api/Index';\nimport { powerTypeEx, powerCn } from '../utils/Const'\n\nconst { ccclass, property } = cc._decorator\n\n@ccclass\nexport default class DialogSource extends cc.Component {\n\n  @property(cc.Node)\n  private item0: cc.Node = null\n  @property(cc.Node)\n  private item1: cc.Node = null\n  @property(cc.Node)\n  private item2: cc.Node = null\n  @property(cc.Node)\n  private item3: cc.Node = null\n  @property(cc.Node)\n  private btn: cc.Node = null\n  @property(cc.Node)\n  private btnClose: cc.Node = null\n\n  // 贡献的神力\n  private devotePower: number = 0\n  protected onLoad () {\n    this.eventHandle()\n    \n  }\n\n  private eventHandle () {\n    const itemActive: cc.SpriteFrame = GM.resManager.texture['pray-b-active']\n    this.item0.on(cc.Node.EventType.TOUCH_END, () => {\n      this.disableOtherItem()\n      this.devotePower = 10\n      this.item0.getComponent(cc.Sprite).spriteFrame = itemActive\n    }, this)\n    this.item1.on(cc.Node.EventType.TOUCH_END, () => {\n      this.disableOtherItem()\n      this.devotePower = 20\n      this.item1.getComponent(cc.Sprite).spriteFrame = itemActive\n    }, this)\n    this.item2.on(cc.Node.EventType.TOUCH_END, () => {\n      this.disableOtherItem()\n      this.devotePower = 50\n      this.item2.getComponent(cc.Sprite).spriteFrame = itemActive\n    }, this)\n    this.item3.on(cc.Node.EventType.TOUCH_END, () => {\n      this.disableOtherItem()\n      this.devotePower = 100\n      this.item3.getComponent(cc.Sprite).spriteFrame = itemActive\n    }, this)\n    this.btn.on(cc.Node.EventType.TOUCH_END, () => {\n      const curPower = GM.user[powerTypeEx(GM.joinPrayItem.powerType)]\n      if (this.devotePower > curPower) {\n        GM.toast('该类型神力不足')\n      } else {\n        this.joinPray()\n        this.btn.off(cc.Node.EventType.TOUCH_START, () => {}, this)\n        this.btn.off(cc.Node.EventType.TOUCH_END, () => {}, this)\n      }\n    }, this)\n    this.btnClose.on(cc.Node.EventType.TOUCH_END, () => {\n      GM.dialog.hideJoinPray()\n    }, this)\n  }\n  private disableOtherItem () {\n    const itemNormal: cc.SpriteFrame = GM.resManager.texture['pray-b-nor']\n    this.item0.getComponent(cc.Sprite).spriteFrame = itemNormal\n    this.item1.getComponent(cc.Sprite).spriteFrame = itemNormal\n    this.item2.getComponent(cc.Sprite).spriteFrame = itemNormal\n    this.item3.getComponent(cc.Sprite).spriteFrame = itemNormal\n  }\n\n  /**\n   * 参与祈祷\n   */\n  private joinPray () {\n    const params = {\n      activityId: GM.joinPrayItem.activityId,\n      accountId: GM.user.accountId,\n      devotePower: this.devotePower\n    }\n    prayPower(params).then(res => {\n      const count = cc.find('progress-desc/count', GM.joinPrayItemNode)\n      const bar = cc.find('progress/bar', GM.joinPrayItemNode)\n      \n      let power = GM.user[powerTypeEx(GM.joinPrayItem.powerType)]\n      power -= this.devotePower\n      // 当前神力\n      count.getComponent(cc.Label).string = GM.joinPrayItem.currentPower + this.devotePower\n      // 设置进度条进度\n      bar.width = Math.round(((GM.joinPrayItem.currentPower + this.devotePower) * 500 / GM.joinPrayItem.totalPower))\n      \n      GM.user[powerTypeEx(GM.joinPrayItem.powerType)] = power\n      GM.toast(`祈祷成功！${powerCn(GM.joinPrayItem.powerType)} -${this.devotePower}`)\n      GM.updateUserPower()\n      GM.dialog.hideJoinPray()\n    })\n  }\n}"]}